<!DOCTYPE html>
<html>
  <head>
    <title>Students</title>
    <%- include('../partials/_method_header.ejs') %>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <%- include('../partials/_navbar.ejs') %>
    </nav>
    <h1 class = "text-center">Student Lookup</h1>
    <div class = "container text-center">
      <form>
        <label for="student-id">Enter student ID:</label>
        <input type="text" id="student-id" name="student-id"><br><br>
        <button type="submit">Lookup</button>
      </form>
    </div>
    <br>
    <div class="container">
      <table class="table table-striped table-bordered table-sm">
        <thead>
          <tr>
            <th>First Name</th>
            <th>Last Name</th>
            <th>GPA</th>
            <th>Enrolled</th>
            <th>ID</th>
          </tr>
        </thead>
        <tbody id="students-table"></tbody>
      </table>
    </div>

    <script>
      const form = document.querySelector('form');
      form.addEventListener('submit', event => {
        event.preventDefault(); // Prevent the default form submission behavior
        const studentId = document.getElementById('student-id').value;
        fetch(`/students/${studentId}`) // Make a GET request to /students/<studentId>
          .then(response => response.json()) // Parse the response as JSON
          .then(student => { // Do something with the JSON data
            const studentsTable = document.getElementById('students-table');
            studentsTable.innerHTML = ''; // Clear the table body

            const tr = document.createElement('tr'); // Create a new table row

            const firstNameTd = document.createElement('td'); // Create a new table cell for first name
            firstNameTd.textContent = student.first_name; // Set the text content to the student's first name
            tr.appendChild(firstNameTd); // Add the cell to the row

            const lastNameTd = document.createElement('td'); // Create a new table cell for last name
            lastNameTd.textContent = student.last_name; // Set the text content to the student's last name
            tr.appendChild(lastNameTd); // Add the cell to the row

            const gpaTd = document.createElement('td'); // Create a new table cell for GPA
            gpaTd.textContent = student.gpa; // Set the text content to the student's GPA
            tr.appendChild(gpaTd); // Add the cell to the row

            const enrolledTd = document.createElement('td'); // Create a new table cell for enrollment status
            enrolledTd.textContent = student.enrolled ? 'Enrolled' : 'Not Enrolled'; // Set the text content to the student's enrollment status
            tr.appendChild(enrolledTd); // Add the cell to the row

            const idTd = document.createElement('td'); // Create a new table cell for ID
            idTd.textContent = student._id; // Set the text content to the student's ID
            tr.appendChild(idTd); // Add the cell to the row

            studentsTable.appendChild(tr); // Add the row to the table body
          })
          .catch(error => console.error(error)); // Handle any errors
      });
    </script>
  </body>
</html>
